# Orbit + Mole — Engineering Handoff Packet (as of 2025-12-30)

## 1. Executive Snapshot
**Current Development Phase:** Integration & Stabilization (Orbit + Mole unification).

**Last Stable Commit:** `175f481f7cc4b077df6b00625afca13219208d43` (2025-12-18) @ `main`.
*Note: Local changes for Orbit/Mole integration (session, focus, index sharing) are implemented and verified but may not be committed yet.*

**What is Working:**
- **Shared Persistence**: Both apps share `~/.orbit/session.json` (state), `~/.orbit/focus.json` (pins), and `~/.orbit/index.json` (metadata).
- **Orbit Headless**: `orbit ci` command for census, export, and session generation.
- **Mole Optimization**: Mole hydrates overview mode from Orbit index for instant startup.
- **Cross-App UI**: High-contrast mode, session restore, and undo stack (Mole).

**What is Incomplete:**
- Automated E2E testing between Rust (Orbit) and Go (Mole) binaries.
- Binary bundling for single-package distribution.
- TODO: owner?, due?, source?

**“Resume in 1 day?” Checklist:**
- [ ] Run `go test ./...` in `Mole/` to verify Go integration stability.
- [ ] Run `cargo test` in root to verify Rust CLI and session logic.
- [ ] Verify `~/.orbit/session.json` exists after quitting either app.
- [ ] Test `orbit ci --root .` and confirm it writes a valid shared index.
- [ ] Open `mole` in overview mode and check for "Ready (Orbit index)" status.

**Active Owners:**
- **TL/Dev**: @tw93 (Source: Repo path)
- **PM/DevOps/QA/Security**: TODO: owner?, due?, source?

---

## 2. Project Specification (What)
- **Scope**: A high-performance disk space analyzer and project management toolset. Orbit handles the high-speed scanning (Rust), while Mole provides a rich, interactive TUI (Go).
- **Goals**: Unified data models, seamless navigation state between tools, and SWE-focused features (delete to trash, project pinning, census reporting).
- **Non-Goals**: Real-time file system watching (current focus is snapshot-based).
- **Stakeholders**: Software engineers managing large local workspaces.
- **Success Metrics**: < 1s startup for Mole via Orbit index; 100% test coverage on integration paths.

---

## 3. Implementation State (How)
- **Orbit (Rust)**: Responsible for `census`, `export`, and `snapshot` operations. It is the authoritative writer for the shared `index.json`.
- **Mole (Go)**: The primary interactive TUI. Consumes shared index for speed; provides "Trash" based undo and batch actions.
- **Shared Data Layer**: JSON files in `~/.orbit/`.
    - `index.json`: Project metadata and sizes.
    - `session.json`: TUI state (panel, selection, search).
    - `focus.json`: User-pinned projects.

**Dependency Graph:**
```
[User] -> [Mole TUI (Go)] --(reads)--> [Shared Index (JSON)]
   |          |                          ^
   |       (writes)                      |
   v          v                          |
[Orbit CLI (Rust)] --(writes)------------+
```

---

## 4. Architecture & Environments
- **Architecture**: Decoupled CLI tools sharing a home-directory state store.
- **Environments**:
    - **Local**: Primary dev environment (macOS/Linux).
    - **CI**: Headless Orbit census via `orbit ci`.
- **Infra**: No cloud infra/IaC currently required.

---

## 5. Versions & Compatibility
- **Languages**: 
    - Go 1.23+ (Mole)
    - Rust 1.80+ (Orbit)
- **Compatibility Matrix**:
    | Component | Version | Depends On | Compatible With |
    | --------- | ------- | ---------- | --------------- |
    | Orbit     | 0.1.0   | Shared JSON| Mole 0.1.0      |
    | Mole      | 0.1.0   | Shared JSON| Orbit 0.1.0     |

---

## 6. Build & Run Guides
**Local Dev Setup:**
1. Install Rust (rustup) and Go.
2. Clone `orbit_merged_full`.

**Build Commands:**
- **Orbit**: `cargo build --release` (Output: `target/release/orbit`)
- **Mole**: `cd Mole && go build ./cmd/analyze` (Output: `Mole/analyze`)

**Running Locally:**
```bash
# Generate index with Orbit
./target/release/orbit ci --root $HOME

# Analyze with Mole
./Mole/analyze --overview
```

---

## 7. Deployment & Release
- **Flow**: Trunk-based development on `main`.
- **Procedure**: Manual binary builds for macOS/Linux targets.
- **Recent Releases**: Integration of Mole into the Orbit repository (Dec 2025).

---

## 8. Configuration, Secrets & Compliance
- **Config**: 
    - `MO_FEATURE_PROJECTS=1`: Enables session/focus logic in Mole.
    - `MO_HIGH_CONTRAST=1`: Forces high-contrast UI.
- **Secrets**: None stored.
- **Compliance**: MIT Licensed.

---

## 9. Testing, QA & Quality Gates
- **Rust Tests**: `cargo test`
- **Go Tests**: `go test ./cmd/analyze`
- **Quality Gates**: New `TestInitialModelUsesOrbitIndexInOverview` ensures integration logic persists.

---

## 10. Observability & Operations
- **Logs**: Mole writes to `~/.mole/error.log`.
- **Runbook**: If index is corrupt, delete `~/.orbit/index.json` and rerun `orbit ci`.

---

## 11. Work Stream & Next Steps
1. **Goal**: Add automated E2E integration test.
   - **Why now**: Prevent drift between Rust and Go models.
   - **How**: Shell script that runs `orbit ci` then `go test` with real JSON artifacts.
2. **Goal**: Consolidate `~/.mole` and `~/.orbit` fully.
   - **Why now**: Simplify user home directory footprint.
3. **Goal**: Implement binary release pipeline (GitHub Actions).

---

## 12. Appendices
- **Data Model**: See `docs/integration_schemas.md`.
- **Glossary**:
    - **Census**: Orbit's process of summarizing all projects in a root.
    - **Focus**: A pinned project tracked across both apps.

---

# Embedded Checklists

### 1-Day Resume Checklist
- [x] Verify build for Orbit: `cargo build`
- [x] Verify build for Mole: `go build ./cmd/analyze`
- [x] Run integration test: `go test -v -run TestInitialModelUsesOrbitIndexInOverview ./cmd/analyze`

### Pre-Deploy Gate Checklist
- [ ] `cargo fmt` and `go fmt` checked.
- [ ] `cargo test` and `go test ./...` passing.
- [ ] Schema version in `integration_schemas.md` matches code.

---

# Machine-Readable Summary
```json
{
  "project_name": "Orbit + Mole Integration",
  "pause_date_iso": "2025-12-30",
  "repo_roots": ["/Volumes/WS4TB/messymarvin/orbit_merged_full"],
  "default_branch": "main",
  "last_stable_commit": {"sha": "175f481f7cc4b077df6b00625afca13219208d43", "date": "2025-12-18T06:41:44-05:00", "message": "Initial merge of Orbit and Mole"},
  "modules": [
    {"name": "Orbit", "path": "src/", "owner": "tw93", "status": "green", "notes": "Rust backend/CLI"},
    {"name": "Mole", "path": "Mole/", "owner": "tw93", "status": "green", "notes": "Go TUI/Frontend"}
  ],
  "versions": {
    "languages": [
      {"name": "Rust", "version": "1.80+"},
      {"name": "Go", "version": "1.23"}
    ],
    "frameworks": [
      {"name": "Bubbletea", "version": "latest"},
      {"name": "Clap", "version": "4.0"}
    ]
  },
  "ci_cd": {
    "pipelines": [],
    "release_flow": "trunk"
  },
  "environments": [
    {"name": "dev", "url": "localhost", "parity_gaps": []}
  ],
  "backlog_next_steps": [
    {"title": "Automated E2E Integration Test", "owner": "tw93", "eta_days": 2, "risk": "low"},
    {"title": "Unified Configuration Management", "owner": "tw93", "eta_days": 3, "risk": "low"}
  ],
  "todos": [
    {"item": "Consolidate legacy ~/.mole paths fully", "owner": "tw93", "due": "2026-01-15"}
  ]
}
```
